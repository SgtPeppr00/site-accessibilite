<!DOCTYPE html>
<html lang="fr">

<head>
	<title>Cartes</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
	<link rel="stylesheet" type="text/css" href="../css/style.css" />
	<style>
		.navsidebar .nav-link.active::after,
		.navbar .nav-link.active::after {
			background-color: #673C90 !important;
			width: 70% !important;
		}

		#cardGrid {
			transition: all 0.3s ease-in-out;
			position: relative;
		}

		.alert-info {
			transition: all 0.3s ease-in-out;
			transform: translateY(-100%);
			opacity: 0;
			top: 0;
			left: 0;
			right: 0;
			z-index: 1050;
			margin: 0;
			border-radius: 1rem;
		}

		.alert-info.show {
			opacity: 1;
			transform: translateY(0);
		}

		@media (max-width: 991px) {
			.alert-info {
				top: 56px;
			}
		}

		/* Add these new styles */
		.input-group:focus-within {
			outline: 6px solid #02007b !important;
			border-radius: 50px;
		}

		.input-group:focus-within input:focus,
		.input-group:focus-within .input-group-text:focus {
			outline: none !important;
		}

		.input-group input,
		.input-group .input-group-text {
			border-color: #ced4da !important;
		}

		.cardGridContainer {
			position: relative;
			min-height: 500px;
		}

		.no-results {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			text-align: center;
			font-size: 1.2rem;
			color: #666;
			width: 100%;
		}
	</style>
</head>

<body>
	<header>
		<!-- Mobile Navbar -->
		<nav class="mobile-header fixed-top navbar navbar-dark py-2 d-lg-none">
			<div class="container mb-2 d-flex justify-content-center align-items-center">
				<a class="navbar-brand m-0" href="accueil.html">
					<img src="/img/logo.png" alt="Sample image" class="img-fluid" width="69" height="69">
				</a>
			</div>
		</nav>
		<!-- Desktop Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark d-none d-lg-block">
			<div class="container d-flex align-items-center">
				<a class="navbar-brand" href="accueil.html">
					<img src="/img/logo.png" alt="Sample image" class="img-fluid" width="69" height="69">
				</a>
				<div class="collapse navbar-collapse justify-content-center" id="navbarNav">
					<ul class="navbar-nav">
						<li class="nav-item">
							<a class="nav-link" href="./accueil.html">Accueil</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active" aria-current="page" href="./cartes.html">Cartes</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="./atelier.html">Atelier</a>
						</li>

						<li class="nav-item">
							<a class="nav-link" href="./contact.html">Contact</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="./a-propos.html">A propos</a>
						</li>
					</ul>
				</div>
				<div class="theme-switch" role="switch" tabindex="0" aria-checked="false" aria-label="Changer le thème">

					<input type="checkbox" id="checkbox" aria-hidden="true" tabindex="-1">
					<span class="slider">
						<span class="slider-circle">
							<svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
								aria-hidden="true">
								<circle cx="12" cy="12" r="4" />
								<line x1="12" y1="3" x2="12" y2="5" />
								<line x1="12" y1="19" x2="12" y2="21" />
								<line x1="5" y1="12" x2="3" y2="12" />
								<line x1="21" y1="12" x2="19" y2="12" />
								<line x1="6.36" y1="6.36" x2="4.94" y2="4.94" />
								<line x1="17.66" y1="17.66" x2="19.07" y2="19.07" />
								<line x1="6.36" y1="17.66" x2="4.94" y2="19.07" />
								<line x1="17.66" y1="6.36" x2="19.07" y2="4.94" />
							</svg>
							<svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"
								aria-hidden="true">
								<path d="M21 12.79A9 9 0 1 1 11.21 3 A7 7 0 0 0 21 12.79z" />
							</svg>
						</span>
					</span>
				</div>
			</div>
		</nav>

	</header>

	<!-- Mobile Sidebar Toggle -->
	<div class="position-absolute burger-menu-container d-lg-none">
		<button class="navbar-toggler" type="button" aria-label="Toggle navigation" aria-expanded="false"
			aria-controls="navsidebar">
			<div class="animated-icon" aria-hidden="true"><span class="burgerspan"></span><span
					class="burgerspan"></span><span class="burgerspan"></span></div>
		</button>
	</div>

	<!-- Mobile Sidebar -->
	<div class="d-flex flex-column flex-shrink-0 p-2 navsidebar d-lg-none" id="navsidebar" role="navigation"
		aria-label="Sidebar">
		<ul class="nav nav-pills flex-column mb-auto">
			<li class="nav-item">
				<a href="./accueil.html" class="nav-link">
					Accueil
				</a>
			</li>
			<li>
				<a href="./cartes.html" class="nav-link active" aria-current="page">
					Cartes
				</a>
			</li>
			<li>
				<a href="./atelier.html" class="nav-link">
					Atelier
				</a>
			</li>
			<li>
				<a href="./contact.html" class="nav-link">
					Contact
				</a>
			</li>
			<li>
				<a href="./a-propos.html" class="nav-link">
					A propos
				</a>
			</li>
		</ul>
		<label class="theme-switch">
			<input type="checkbox" id="checkboxmobile">
			<span class="slider">
				<span class="slider-circle">
					<svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<circle cx="12" cy="12" r="4" />
						<line x1="12" y1="3" x2="12" y2="5" />
						<line x1="12" y1="19" x2="12" y2="21" />
						<line x1="5" y1="12" x2="3" y2="12" />
						<line x1="21" y1="12" x2="19" y2="12" />
						<line x1="6.36" y1="6.36" x2="4.94" y2="4.94" />
						<line x1="17.66" y1="17.66" x2="19.07" y2="19.07" />
						<line x1="6.36" y1="17.66" x2="4.94" y2="19.07" />
						<line x1="17.66" y1="6.36" x2="19.07" y2="4.94" />
					</svg>
					<svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
						<path d="M21 12.79A9 9 0 1 1 11.21 3 A7 7 0 0 0 21 12.79z" />
					</svg>
				</span>
			</span>
		</label>
	</div>
	<main>
		<div class="hero-section d-flex align-items-center justify-content-center mb-5"
			style="background: url('/img/carteshero.png') center/cover no-repeat;">
			>
			<h1 class="hero-title fw-bold text-center position-relative">Notre jeu de cartes</h1>
		</div>
		<div class="container mt-5" style="width: 90%;">

			<button href="./cartes.html" class="btn btn-primary mb-4 visually-hidden-focusable fixed-top"
				id="skipToCards" tabindex="1">
				Passer directement aux cartes
			</button>
			<div class="d-flex filters justify-content-between mt-5 mb-4 w-100 h-50 h-sm-25" role="search">
				<div class="col-12 col-lg-4 me-5" role="group" aria-label="Filtres de cartes">
					<div class="input-group" role="search">
						<span class="input-group-text rounded-start-pill bg-white border-end-0" aria-hidden="true">
							<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
								class="bi bi-search" viewBox="0 0 16 16">
								<path
									d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z" />
							</svg>
						</span>
						<input type="search" class="form-control rounded-end-pill border-start-0"
							placeholder="Rechercher..." id="searchBar" aria-label="Rechercher des cartes" />
					</div>
				</div>
				<div class="btn-group col-12 col-lg-8 d-flex gap-2" role="group" aria-label="Filtres de cartes">
				</div>
			</div>
			<div class="alert alert-info p-4 mb-4 text-center d-none" role="alert">
				<p class="h4 mb-0" id="nameOfFamily"></p>
			</div>
			<h2 id="familytitle" class="text-center mt-5 mb-5">Toutes les cartes</h2>
			<div class="cardGridContainer">
				<div class="row row-cols-2 row-cols-lg-4 gx-0 gy-4 gx-md-5 g-lg-5 mb-5" id="cardGrid" role="list">
				</div>
			</div>

		</div>
		<button class="button button-primary rounded-circle position-fixed bottom-0 end-0 m-4 d-none" id="scrollTopBtn"
			style="z-index: 1000; width: 50px; height: 50px; padding: 10px;" style="z-index: 1000;"
			aria-label="Retour en haut">
			<svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="currentColor" class="bi bi-arrow-up"
				viewBox="0 0 16 16">
				<path fill-rule="evenodd"
					d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
			</svg>
		</button>
	</main>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
	<style>
		.filter-button {
			font-size: 1rem;
			font-weight: bold;
			transition: all 0.3s ease;
			border-radius: 25px;
			display: flex;
			align-items: center;
			justify-content: center;
		}

		.filter-button:hover {
			transform: translateY(-2px);
			box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
		}


		@media (max-width: 768px) {
			.filter-button {
				padding: 8px 16px;
				font-size: 0.9rem;
			}
		}

		#cardGrid:focus {
			background-color: #207cc4;

		}

		@font-face {
			font-family: "Luciole";
			src: url("../fonts/Luciole-Regular.ttf");
		}

		#skipToCards {
			border-radius: 0 0 50px 50px;
		}

		.h-45 {
			height: 45%;
		}

		* {
			font-family: "Luciole", sans-serif;
			text-align: start;
		}

		*:focus-visible {
			outline: 6px solid #02007b !important;
		}

		.card-title {
			text-align: center;
		}


		.subTitle {
			font-weight: bold;
		}

		.card-img-top:focus {
			outline: 6px solid #02007b;
		}

		.bluebg {
			background-color: transparent;
			border: 0.15em solid #1578BE;
			color: #1578BE;
		}

		.bluebg:hover,
		.bluebg:focus,
		.bluebg.button-primary {
			background-color: #1578BE;
			color: white !important;
		}

		.redbg {
			background-color: transparent;
			border: 0.15em solid #BD1D59;
			color: #BD1D59;
		}

		.redbg:hover,
		.redbg:focus,
		.redbg.button-primary {
			background-color: #BD1D59;
			color: white !important;
		}

		.greenbg {
			background-color: transparent;
			border: 0.15em solid #7BB928;
			color: #7BB928;
		}

		.greenbg:hover,
		.greenbg:focus,
		.greenbg.button-primary {
			background-color: #7BB928;
			color: white !important;
		}

		.orangebg {
			background-color: transparent;
			border: 0.15em solid #EA9506;
			color: #EA9506;
		}

		.orangebg:hover,
		.orangebg:focus,
		.orangebg.button-primary {
			background-color: #EA9506;
			color: white !important;
		}

		.purplebg {
			background-color: transparent;
			border: 0.15em solid #673C90;
			color: #673C90;
		}

		.purplebg:hover,
		.purplebg:focus,
		.purplebg.button-primary {
			background-color: #673C90;
			color: white !important;
		}

		@media (min-width: 1000px) {
			.subTitle {
				font-size: 1.4rem;
			}

			.description {
				font-size: 1.2rem;
			}
		}

		@media (max-width: 1000px) {
			.filters {
				flex-direction: column;
			}

			.modal-dialog {
				max-width: 100% !important;
			}

			.filter-button {
				margin-top: 1rem;
				font-size: 0.8rem;
			}

			#searchBar {
				height: 50.4px;
			}
		}
	</style>
	<footer class="py-2 bg-dark text-white">
		<div class="container">
			<div class="row align-items-center">
				<!-- Logo -->
				<div class="col-md-1 col-12 text-center mb-3">
					<img src="/img/logo.png" alt="Logo HandiScope" class="img-fluid" width="100">
				</div>

				<!-- Navigation -->
				<div class="col-md-9 col-12">
					<nav class="d-flex justify-content-around small flex-wrap">
						<a class="nav-link px-3 mb-2" href="./credit.html">Cr&eacute;dits & Ressources</a>
						<a class="nav-link px-3 mb-2" href="./mentions-legales.html">Mentions l&eacute;gales</a>
						<a class="nav-link px-3 mb-2" href="./accessibilite.html">Accessibilité</a>
						<a class="nav-link px-3 mb-2" href="./conditions.html">Conditions d'utilisation</a>
						<a class="nav-link px-3 mb-2" href="./plan-site.html">Plan du site</a>
					</nav>
				</div>

				<!-- Back to top button -->
				<div class="col-md-2 col-12 text-center mt-3 mt-md-0">
					<button onclick="window.scrollTo({top: 0, behavior: 'smooth'})"
						class="btn btn-pill text-white rounded-pill" style="background-color: #BD1D59;">
						<span style="position: relative; top: -2px;">↑</span> Retour en haut
					</button>
				</div>
			</div>

			<!-- Copyright -->
			<div class="row mt-4">
				<div class="col text-center text-md-end">
					<p class="mb-0">&copy; 2024 HandiScope. Tous droits r&eacute;serv&eacute;s.</p>
				</div>
			</div>
		</div>
	</footer>

	<script src=" https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
		</script>
	<script src="../javascript/script.js"></script>
	<script>
		const synth = window.speechSynthesis;
		let activeFilter = document.querySelector(".btn-group .button.button-primary")?.getAttribute("data-category");
		let isHovering = false;
		function initalizeScrollUpButton() {
			const scrollBtn = document.getElementById('scrollTopBtn');

			const toggleScrollBtn = () => {
				if (window.innerWidth < 1000) {
					scrollBtn.classList.remove('d-none');
					scrollBtn.classList.add('d-block');
				} else {
					scrollBtn.classList.remove('d-block');
					scrollBtn.classList.add('d-none');
				}
			};

			scrollBtn.addEventListener('click', () => {
				window.scrollTo({ top: 0, behavior: 'smooth' });
			});

			window.addEventListener('resize', toggleScrollBtn);
			toggleScrollBtn();

		}

		function initializeSearchBar() {
			document.getElementById("searchBar").addEventListener("input", function () {
				const searchTerm = this.value.toLowerCase();
				const cards = document.querySelectorAll(".card-item");
				const activeCategory = document.querySelector(".btn-group .button.button-primary")?.getAttribute("data-category");
				let i = 0;
				let visibleCards = 0;

				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					const id = card.dataset.image.slice(0, -4).toLowerCase();
					const matchesSearch = title.includes(searchTerm) || id.includes(searchTerm);
					const matchesCategory = !activeCategory || card.getAttribute("data-category") === activeCategory;

					if (matchesSearch && matchesCategory) {
						card.style.display = "block";
						card.querySelector("img").tabIndex = 0;
						card.setAttribute("data-id", i);
						i += 1;
						visibleCards++;
					} else {
						card.style.display = "none";
						card.querySelector("img").tabIndex = -1;
						card.setAttribute("data-id", "");
					}
				});

				// Handle no results message
				const existingMessage = document.querySelector('.no-results');
				if (visibleCards === 0) {
					if (!existingMessage) {
						const noResults = document.createElement('div');
						noResults.className = 'no-results';
						noResults.textContent = 'Aucune carte ne correspond à ces critères';
						document.getElementById('cardGrid').appendChild(noResults);
					}
				} else if (existingMessage) {
					existingMessage.remove();
				}
			});
		}

		function filterCards(category) {
			const searchTerm = document.getElementById("searchBar").value.toLowerCase();
			const cards = document.querySelectorAll(".card-item");
			const buttons = document.querySelectorAll(".btn-group .button");
			const activeButton = document.querySelector(`.btn-group .button.button-primary[data-category="${category}"]`);
			const button = document.querySelector(`.btn-group .button[data-category="${category}"]`);
			activeFilter = category;
			console.log(activeFilter);
			console.log(button);
			if (activeButton) {
				// If the clicked button is already active, remove the filter
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					card.style.display = title.includes(searchTerm) ? "block" : "none";
				});

				// Reset all buttons
				buttons.forEach((button) => {
					button.classList.remove("button-primary");
					// Restore original colors based on background class
					if (button.classList.contains('bluebg')) {
						button.style.color = '#207cc4';
					} else if (button.classList.contains('redbg')) {
						button.style.color = '#c0245c';
					} else if (button.classList.contains('greenbg')) {
						button.style.color = '#78c444';
					} else if (button.classList.contains('orangebg')) {
						button.style.color = '#f09424';
					} else if (button.classList.contains('purplebg')) {
						button.style.color = '#68449c';
					}
				});
				activeFilter = null;
				document.getElementById("familytitle").innerText = "Toutes les cartes";
			} else {
				// Apply the filter
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					const matchesSearch = title.includes(searchTerm);
					const matchesCategory = card.getAttribute("data-category") === category;
					card.style.display = matchesSearch && matchesCategory ? "block" : "none";
				});

				// Update button styles
				buttons.forEach((button) => {
					if (button.getAttribute("data-category") === category) {
						button.classList.add("button-primary");
						button.style.color = 'white';
					} else {
						button.classList.remove("button-primary");
						// Restore original colors for inactive buttons
						if (button.classList.contains('bluebg')) {
							button.style.color = '#207cc4';
						} else if (button.classList.contains('redbg')) {
							button.style.color = '#c0245c';
						} else if (button.classList.contains('greenbg')) {
							button.style.color = '#78c444';
						} else if (button.classList.contains('orangebg')) {
							button.style.color = '#f09424';
						} else if (button.classList.contains('purplebg')) {
							button.style.color = '#68449c';
						}
					}
				});
				document.getElementById("familytitle").innerText = button.getAttribute("familyname");

			}

			let i = 0;
			let visibleCards = 0;
			cards.forEach((card) => {
				if (card.style.display === "block") {
					card.querySelector("img").tabIndex = 0;
					card.setAttribute("data-id", i);
					i += 1;
					visibleCards++;
				} else {
					card.querySelector("img").tabIndex = -1;
					card.setAttribute("data-id", "");
				}
			});

			// Handle no results message
			const existingMessage = document.querySelector('.no-results');
			if (visibleCards === 0) {
				if (!existingMessage) {
					const noResults = document.createElement('div');
					noResults.className = 'no-results';
					noResults.textContent = 'Aucune carte ne correspond à ces critères';
					document.getElementById('cardGrid').appendChild(noResults);
				}
			} else if (existingMessage) {
				existingMessage.remove();
			}
		}

		function setupSkipButton() {
			const skipButton = document.getElementById("skipToCards");
			["click", "keydown"].forEach(function (e) {
				skipButton.addEventListener(e, () => {
					if (e === "keydown" && event.key !== "Enter") {
						return;
					}
					const firstVisibleCard = Array.from(document.querySelectorAll('.card-item')).find(card =>
						window.getComputedStyle(card).display !== 'none')?.querySelector('img');
					if (firstVisibleCard) {
						firstVisibleCard.focus();
						firstVisibleCard.scrollIntoView();
					}
					skipButton.blur();
				});
			});
		}
		function displayFamilyName(familyName) {
			isHovering = true;
			const nameDiv = document.querySelector('#nameOfFamily');
			const alertDiv = nameDiv.parentElement;

			nameDiv.textContent = familyName;
			alertDiv.classList.remove('d-none');
			setTimeout(() => {
				alertDiv.classList.add('show');
			}, 10);

			// Set colors based on family name
			if (familyName.toLowerCase().includes('journée')) {
				alertDiv.style.backgroundColor = '#207cc4';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('accessibilité')) {
				alertDiv.style.backgroundColor = '#c0245c';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('matériel')) {
				alertDiv.style.backgroundColor = '#f09424';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('numérique')) {
				alertDiv.style.backgroundColor = '#78c444';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('événements')) {
				alertDiv.style.backgroundColor = '#68449c';
				nameDiv.style.color = 'white';
			}
		}

		function updateDisplayedText() {
			const activeFamilyName = getActiveFamilyName();
			if (activeFamilyName) {
				displayFamilyName(activeFamilyName);
			} else {
				hideFamilyName();
			}
		}

		function getActiveFamilyName() {
			if (activeFilter) {
				const button = document.querySelector(`.filter-button[data-category="${activeFilter}"]`);
				return button ? button.getAttribute("familyName") : null;
			}
			return null;
		}

		let hideTimeout;

		function hideFamilyName() {
			isHovering = false;
			clearTimeout(hideTimeout);
			hideTimeout = setTimeout(() => {
				if (!activeFilter && !isHovering) {
					const nameDiv = document.querySelector('#nameOfFamily');
					const alertDiv = nameDiv.parentElement;
					alertDiv.classList.remove('show');
					setTimeout(() => {
						alertDiv.classList.add('d-none');
					}, 300);
				}
			}, 500);
		}

		function handleButtonHover() {
			isHovering = true;
			clearTimeout(hideTimeout);
		}
		function removeFocus() {
			document.activeElement.blur();
		}

		function fetchAndDisplayCards() {
			fetch("../data/cartes.json")
				.then((response) => response.json())
				.then((data) => {
					const buttonGroup = document.querySelector(".btn-group");

					// Define the desired order of categories
					const categoryOrder = [
						"accessibilite-des-lieux",          // rose (rouge)
						"evenements-sociaux-professionnels", // violet
						"materiel",                         // jaune (orange)
						"numerique",                        // vert
						"organisation-de-la-journee"        // bleu
					];

					// Create buttons in the specified order
					categoryOrder.forEach(categoryId => {
						const famille = data.familles.find(f => f.id === categoryId);
						if (!famille) return;

						const button = document.createElement("button");
						button.className = "button button-secondary mx-1 rounded-pill filter-button";
						button.setAttribute("data-category", famille.id);
						button.addEventListener("click", () => filterCards(famille.id));
						button.classList.add("filter-button");
						button.setAttribute("familyName", famille.titre);
						button.setAttribute("title", `Filtrer par ${famille.titre}`);

						if (famille.id == "organisation-de-la-journee") {
							button.classList.add("bluebg");
							button.dataset.originalBg = "bluebg";
							button.textContent = "BLEU";

						}
						if (famille.id == "accessibilite-des-lieux") {
							button.classList.add("redbg");
							button.dataset.originalBg = "redbg";
							button.textContent = "ROSE";

						}
						if (famille.id == "materiel") {
							button.classList.add("orangebg");
							button.dataset.originalBg = "orangebg";
							button.textContent = "JAUNE";

						}
						if (famille.id == "numerique") {
							button.classList.add("greenbg");
							button.dataset.originalBg = "greenbg";
							button.textContent = "VERT";

						}
						if (famille.id == "evenements-sociaux-professionnels") {
							button.classList.add("purplebg");
							button.dataset.originalBg = "purplebg";
							button.textContent = "VIOLET";

						}
						button.addEventListener("mouseover", () => displayFamilyName(famille.titre));
						button.addEventListener("mouseout", updateDisplayedText);
						button.addEventListener("focus", () => displayFamilyName(famille.titre));
						button.addEventListener("mouseleave", () => removeFocus());
						buttonGroup.appendChild(button);

					});

					const cardGrid = document.getElementById("cardGrid");
					cardGrid.innerHTML = "";
					let i = 0;
					let previousfamily = "";
					let idNum = 0;
					data.familles.forEach((famille) => {
						famille.cartes.forEach((carte) => {
							if (previousfamily != famille.id) {
								idNum = 0;
							}
							idNum += 1;
							let addon = "";
							if (famille.id == "organisation-de-la-journee") {
								addon = "BL";
							}
							if (famille.id == "accessibilite-des-lieux") {
								addon = "RO";
							}
							if (famille.id == "materiel") {
								addon = "OR";
							}
							if (famille.id == "numerique") {
								addon = "VE";
							}
							if (famille.id == "evenements-sociaux-professionnels") {
								addon = "VI";
							}
							const card = document.createElement("div");
							card.className = "col card-item";
							card.setAttribute("data-category", famille.id);
							card.setAttribute("data-title", carte.titre);
							card.setAttribute("data-subtitle", carte.sousTitre);
							card.setAttribute("data-description", carte.description);
							card.setAttribute("data-image", `${carte.id}-${addon}0${idNum}.png`);
							card.setAttribute("data-id", i);

							card.style.display = "block";
							i += 1;
							previousfamily = famille.id;

							// Afficher uniquement l'image dans la carte
							card.innerHTML = `
						<div class="card h-100" role="listitem" aria-labelledby="card-title-${carte.id}" aria-describedby="card-description-${carte.id}">
							<img src="../img/cartes_new/${carte.id}-${addon}0${idNum}.png" class="card-img-top h-100" alt="${carte.titre}" tabindex="0" aria-labelledby="card-title-${carte.id}" />

						</div>
					`;

							cardGrid.appendChild(card);
						});
					});

					// Ajouter des écouteurs d'événements aux images après l'ajout de toutes les cartes
					document.querySelectorAll(".card-item img").forEach((img) => {
						["click", "keydown"].forEach(function (e) {
							img.addEventListener(e, () => {
								if (e === "keydown" && event.key !== "Enter") {
									return;
								}
								const card = img.closest(".card-item");
								const title = card.dataset.title;
								const subTitle = card.dataset.subtitle;
								const description = card.dataset.description;
								const id = card.dataset.id;

								// Création du modal avec uniquement l'image et le contenu de la carte
								const modal = document.createElement("div");
								modal.className = "modal fade";
								modal.tabIndex = -1;
								modal.innerHTML = `
												<div class="modal-dialog modal-dialog-centered modal-xl px-5" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDescription">
													<div class="modal-content position-relative px-5">
														<button type="button" class="btn btn-secondary position-absolute start-0 top-50 translate-middle-y" 
																style="z-index: 1000; margin-left: 25px;" 
																id="prevCard" data-id="${id}" 
																aria-label="Previous card">&#11164;</button>

														<button type="button" class="btn btn-secondary position-absolute end-0 top-50 translate-middle-y" 
																style="z-index: 1000; margin-right: 25px;" 
																id="nextCard" data-id="${id}" 
																aria-label="Next card">&#11166;</button>

														<div class="modal-header">
															<h5 class="modal-title" id="modalTitle">${title}</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body" id="modalDescription">
															<div class="d-flex flex-column flex-lg-row justify-content-between align-items-center">
																<div class="position-relative w-100 w-lg-75 mb-3 mb-lg-0" style="max-width: 80%;">
																	<img src="../img/cartes_new/${card.dataset.image}" class="img-fluid mx-auto d-block" style="max-width: 95%;" alt="${title}" />
																</div>

																<div class="w-100 w-lg-50 text-center text-lg-start px-3">
																	<h6 class="subTitle">"${subTitle}"</h6>
																	<p class="description">${description}</p>
																	<button type="button" class="btn btn-info button-info mb-3" aria-label="Écouter la carte">
																		<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-mic-fill" viewBox="0 0 16 16">
																			<path d="M5 3a3 3 0 0 1 6 0v5a3 3 0 0 1-6 0V3z"/>
																			<path d="M3.5 6.5A.5.5 0 0 1 4 7v1a4 4 0 0 0 8 0V7a.5.5 0 0 1 1 0v1a5 5 0 0 1-4.5 4.975V15h3a.5.5 0 0 1 0 1h-7a.5.5 0 0 1 0-1h3v-2.025A5 5 0 0 1 3 8V7a.5.5 0 0 1 .5-.5z"/>
																		</svg>
																	</button>
																</div>
															</div>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
														</div>
													</div>
												</div>
												`;

								document.body.appendChild(modal);
								const bootstrapModal = new bootstrap.Modal(modal);
								bootstrapModal.show();

								// Lecture de la carte
								modal.querySelector(".button-info").addEventListener("click", () => {
									const utterance = new SpeechSynthesisUtterance(`${title}. ${subTitle}. ${description}`);
									utterance.lang = "fr-FR";
									synth.speak(utterance);
								});
								modal.querySelectorAll("button").forEach((button) => {
									addCursorEffect(button);
								});
								modal.querySelectorAll("#nextCard, #prevCard").forEach((button) => {
									button.addEventListener("click", () => {
										handleCardNavigation(button.id === "nextCard" ? "next" : "prev", parseInt(button.dataset.id));
									});
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "Escape") {
										bootstrapModal.hide();
									}
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "p") {
										synth.cancel();
									}
								});

								// Suppression du modal après sa fermeture
								modal.addEventListener("hidden.bs.modal", () => {
									modal.remove();
								});
							});
						});
					});
					document
						.querySelectorAll(
							"a, button, input, img, .btn-group .button, .button-info, input, .slider"
						)
						.forEach((element) => {
							addCursorEffect(element);
						});

				})
				.catch((error) => console.error("Error fetching data:", error));
		}

		function handleCardNavigation(direction, id) {
			const allcards = document.querySelectorAll(".card-item");
			const cards = Array.from(allcards).filter((card) => card.style.display === "block");
			const modal = document.querySelector(".modal");
			const nextCard = direction === "next" ? id + 1 : id - 1;
			const card = cards[nextCard];
			if (card) {
				const title = card.dataset.title;
				const subTitle = card.dataset.subtitle;
				const description = card.dataset.description;
				const image = card.dataset.image;
				const id = card.dataset.id;

				modal.querySelector(".modal-title").textContent = title;
				modal.querySelector("img").src = `../img/cartes_new/${image}`;
				modal.querySelector("img").alt = title;
				modal.querySelector("h6").textContent = `"${subTitle}"`;

				modal.querySelector("p").textContent = description;
				modal.querySelector("#nextCard").dataset.id = id;
				modal.querySelector("#prevCard").dataset.id = id;
			} else {
				if (direction === "next") {
					const title = cards[0].dataset.title;
					const subTitle = cards[0].dataset.subtitle;
					const description = cards[0].dataset.description;
					const image = cards[0].dataset.image;
					const id = cards[0].dataset.id;

					modal.querySelector(".modal-title").textContent = title;
					modal.querySelector("img").src = `../img/cartes_new/${image}`;
					modal.querySelector("img").alt = title;
					modal.querySelector("h6").textContent = `"${subTitle}"`;

					modal.querySelector("p").textContent = description;
					modal.querySelector("#nextCard").dataset.id = id;
					modal.querySelector("#prevCard").dataset.id = id;
				} else {
					const title = cards[cards.length - 1].dataset.title;
					const subTitle = cards[cards.length - 1].dataset.subtitle;
					const description = cards[cards.length - 1].dataset.description;
					const image = cards[cards.length - 1].dataset.image;
					const id = cards[cards.length - 1].dataset.id;

					modal.querySelector(".modal-title").textContent = title;
					modal.querySelector("img").src = `../img/cartes_new/${image}`;
					modal.querySelector("img").alt = title;
					modal.querySelector("h6").textContent = `"${subTitle}"`;

					modal.querySelector("p").textContent = description;
					modal.querySelector("#nextCard").dataset.id = id;
					modal.querySelector("#prevCard").dataset.id = id;
				}
			}
		}



		function handleKeyEvents() {
			document.addEventListener("keydown", (event) => {
				const modal = document.querySelector(".modal");
				if (modal) {
					if (event.key === "ArrowLeft") {
						const id = parseInt(modal.querySelector("#prevCard").dataset.id);
						handleCardNavigation("prev", id);
					}
					if (event.key === "ArrowRight") {
						const id = parseInt(modal.querySelector("#nextCard").dataset.id);
						handleCardNavigation("next", id);
					}
				}
			});
		}

		// Initialize functions on DOMContentLoaded
		document.addEventListener("DOMContentLoaded", () => {
			initalizeScrollUpButton();
			initializeSearchBar();
			setupSkipButton();
			fetchAndDisplayCards();
			handleKeyEvents();
		});
	</script>

</body>

</html>