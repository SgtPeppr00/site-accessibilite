<!DOCTYPE html>
<html lang="fr">

<head>
	<title>Cartes</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous" />
	<link rel="stylesheet" type="text/css" href="../css/style.css" />
</head>

<body>
	<header>
		<!-- Desktop Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark d-none d-lg-block">
			<div class="container">
				<a class="navbar-brand" href="accueil.html">Panorama-Handicap</a>
				<div class="collapse navbar-collapse" id="navbarNav">
					<ul class="navbar-nav ms-auto">
						<li class="nav-item">
							<a class="nav-link" aria-current="page" href="accueil.html">Accueil</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="atelier.html">Atelier</a>
						</li>
						<li class="nav-item">
							<a class="nav-link active text-white" aria-current="page" href="cartes.html">Cartes</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="ressources.html">Ressources</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="a-propos.html">À propos</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="contact.html">Contact</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" href="credit.html">Credit</a>
						</li>
					</ul>
					<button id="themebutton" class="btn btn-light ms-3">
						<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
							class="bi bi-sun" viewBox="0 0 16 16">
							<path
								d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708" />
						</svg>
					</button>
					<div>
						<input type="checkbox" class="checkbox" id="checkbox">
						<label for="checkbox" class="checkbox-label">
							<i class="fas fa-moon"></i>
							<i class="fas fa-sun"></i>
							<span class="ball"></span>
						</label>
					</div>
				</div>
			</div>
		</nav>
	</header>

	<!-- Mobile Sidebar Toggle -->
	<div class="position-absolute burger-menu-container d-lg-none">
		<button class="navbar-toggler mt-5" type="button" aria-label="Toggle navigation" aria-expanded="false"
			aria-controls="navsidebar">
			<div class="animated-icon" aria-hidden="true"><span class="burgerspan"></span><span
					class="burgerspan"></span><span class="burgerspan"></span></div>
		</button>
	</div>

	<!-- Mobile Sidebar -->
	<div class="d-flex flex-column flex-shrink-0 p-3 navsidebar d-lg-none" id="navsidebar" role="navigation"
		aria-label="Sidebar">
		<span class="fs-4 mt-5">Sidebar</span>
		<hr>
		<ul class="nav nav-pills flex-column mb-auto">
			<li class="nav-item">
				<a href="../pages/accueil.html" class="nav-link">
					Accueil
				</a>
			</li>
			<li>
				<a href="../pages/cartes.html" class="nav-link active link-light" aria-current="page">
					Cartes
				</a>
			</li>
			<li>
				<a href="../pages/atelier.html" class="nav-link">
					Atelier
				</a>
			</li>
			<li>
				<a href="../pages/contact.html" class="nav-link">
					Contact
				</a>
			</li>
			<li>
				<a href="#" class="nav-link">
					A propos
				</a>
			</li>
			<li>
				<a href="../pages/credit.html" class="nav-link">
					Credit
				</a>
			</li>
			<li>
				<a href="../pages/ressources.html" class="nav-link">
					Ressources
				</a>
			</li>
		</ul>
		<hr>
		<button id="themebuttonmobile" class="btn btn-light">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-sun"
				viewBox="0 0 16 16">
				<path
					d="M8 11a3 3 0 1 1 0-6 3 3 0 0 1 0 6m0 1a4 4 0 1 0 0-8 4 4 0 0 0 0 8M8 0a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 0m0 13a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-1 0v-2A.5.5 0 0 1 8 13m8-5a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2a.5.5 0 0 1 .5.5M3 8a.5.5 0 0 1-.5.5h-2a.5.5 0 0 1 0-1h2A.5.5 0 0 1 3 8m10.657-5.657a.5.5 0 0 1 0 .707l-1.414 1.415a.5.5 0 1 1-.707-.708l1.414-1.414a.5.5 0 0 1 .707 0m-9.193 9.193a.5.5 0 0 1 0 .707L3.05 13.657a.5.5 0 0 1-.707-.707l1.414-1.414a.5.5 0 0 1 .707 0m9.193 2.121a.5.5 0 0 1-.707 0l-1.414-1.414a.5.5 0 0 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .707M4.464 4.465a.5.5 0 0 1-.707 0L2.343 3.05a.5.5 0 1 1 .707-.707l1.414 1.414a.5.5 0 0 1 0 .708" />
			</svg>
		</button>
	</div>

	<p class="mt-5 opacity-0">.</p>
	<div class="container mt-5" style="width: 70%;">

		<button href="./cartes.html" class="btn btn-primary mb-4 visually-hidden-focusable fixed-top" id="skipToCards"
			tabindex="1">
			Passer directement aux cartes
		</button>
		<div class="d-flex filters justify-content-between mt-5 mb-4 w-100">
			<input type="text" class="form-control me-5 h-50 searchbar rounded-pill" placeholder="Rechercher..."
				id="searchBar" aria-label="Rechercher des cartes" />

			<div class="btn-group col-12 col-lg-8 d-flex gap-2" role="group" aria-label="Filter buttons">
			</div>
		</div>
		<div class="alert alert-info p-4 mb-4 text-center d-none" role="alert">
			<p class="h4 mb-0" id="nameOfFamily"></p>
		</div>
		<div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 gx-5 gy-5" id="cardGrid" role="list"></div>

	</div>
	<button class="btn btn-primary rounded-circle position-fixed bottom-0 end-0 m-4 d-none" id="scrollTopBtn"
		style="z-index: 1000; width: 50px; height: 50px; padding: 10px;" style="z-index: 1000;"
		aria-label="Retour en haut">
		<svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-arrow-up"
			viewBox="0 0 16 16">
			<path fill-rule="evenodd"
				d="M8 15a.5.5 0 0 0 .5-.5V2.707l3.146 3.147a.5.5 0 0 0 .708-.708l-4-4a.5.5 0 0 0-.708 0l-4 4a.5.5 0 1 0 .708.708L7.5 2.707V14.5a.5.5 0 0 0 .5.5z" />
		</svg>
	</button>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
	<style>
		#cardGrid:focus {
			background-color: #207cc4;

		}

		@font-face {
			font-family: "Luciole";
			src: url("../fonts/Luciole-Regular.ttf");
		}

		#skipToCards {
			border-radius: 0 0 50px 50px;
		}

		.h-45 {
			height: 45%;
		}

		* {
			font-family: "Luciole", sans-serif;
			text-align: start;
		}

		*:focus-visible {
			outline: 6px solid #02007b !important;
		}

		.card-title {
			text-align: center;
		}


		.subTitle {
			font-weight: bold;
		}

		.card-img-top:focus {
			outline: 6px solid #02007b;
		}

		.bluebg {
			background-color: transparent;
			border: 0.2em solid #207cc4;
			color: #207cc4;
		}

		.bluebg:hover,
		.bluebg:focus {
			background-color: #1a5f90;
			color: white;
		}

		.redbg {
			background-color: transparent;
			border: 0.2em solid #c0245c;
			color: #c0245c;
		}

		.redbg:hover,
		.redbg:focus {
			background-color: #8e1b45;
			color: white;
		}

		.greenbg {
			background-color: transparent;
			border: 0.2em solid #78c444;
			color: #78c444;
		}

		.greenbg:hover,
		.greenbg:focus {
			background-color: #5c9333;
			color: white;
		}

		.orangebg {
			background-color: transparent;
			border: 0.2em solid #f09424;
			color: #f09424;
		}

		.orangebg:hover,
		.orangebg:focus {
			background-color: #b36e1b;
			color: white;
		}

		.purplebg {
			background-color: transparent;
			border: 0.2em solid #68449c;
			color: #68449c;
		}

		.purplebg:hover,
		.purplebg:focus {
			background-color: #4e3474;
			color: white;
		}

		@media (min-width: 1000px) {
			.subTitle {
				font-size: 1.4rem;
			}

			.description {
				font-size: 1.2rem;
			}
		}

		@media (max-width: 1000px) {
			.filters {
				flex-direction: column;
			}

			.modal-dialog {
				max-width: 100% !important;
			}

			.filter-button {
				margin-top: 1rem;
				font-size: 0.8rem;
			}

			#searchBar {
				width: 100% !important;
			}
		}
	</style>
	<footer class="py-5">
		<div class="container d-flex flex-column">
			<div class="d-flex justify-content-evenly align-items-center">
				<div class="logo">
					<img src="https://placehold.co/50x50/EEE/31343C" alt="Sample image" class="img-fluid">
				</div>
				<ul class="nav flex-row">
					<li class="nav-item">
						<a class="nav-link" href="#">Accueil</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Cartes</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Atelier</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">Contact</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#">A propos</a>
					</li>
				</ul>
				<div class="logo">
					<img src="https://placehold.co/50x50/EEE/31343C" alt="Sample image" class="img-fluid">
				</div>
			</div>
			<div class="d-flex justify-content-evenly align-items-center mt-5">
				<p>Lorem ipsum dolor sit amet.</p>
				<p>Lorem ipsum dolor sit amet.</p>
				<p>Lorem ipsum dolor sit amet.</p>
			</div>
		</div>
	</footer>
	<script src=" https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous">
		</script>
	<script src="../javascript/script.js"></script>
	<script>
		const synth = window.speechSynthesis;
		const cursorCircle = document.createElement("div");
		let activeFilter = document.querySelector(".btn-group .btn.btn-primary")?.getAttribute("data-category");
		let isHovering = false;
		function initalizeScrollUpButton() {
			const scrollBtn = document.getElementById('scrollTopBtn');

			const toggleScrollBtn = () => {
				if (window.innerWidth < 1000) {
					scrollBtn.classList.remove('d-none');
					scrollBtn.classList.add('d-block');
				} else {
					scrollBtn.classList.remove('d-block');
					scrollBtn.classList.add('d-none');
				}
			};

			scrollBtn.addEventListener('click', () => {
				window.scrollTo({ top: 0, behavior: 'smooth' });
			});

			window.addEventListener('resize', toggleScrollBtn);
			toggleScrollBtn();

		}

		function initializeSearchBar() {
			document.getElementById("searchBar").addEventListener("input", function () {
				const searchTerm = this.value.toLowerCase();
				const cards = document.querySelectorAll(".card-item");
				const activeCategory = document.querySelector(".btn-group .btn.btn-primary")?.getAttribute("data-category");
				let i = 0;
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					const id = card.dataset.image.slice(0, -4).toLowerCase();
					const matchesSearch = title.includes(searchTerm) || id.includes(searchTerm);
					const matchesCategory = !activeCategory || card.getAttribute("data-category") === activeCategory;

					if (matchesSearch && matchesCategory) {
						card.style.display = "block";
						card.querySelector("img").tabIndex = 0;
						card.setAttribute("data-id", i);
						i += 1;
					} else {
						card.style.display = "none";
						card.querySelector("img").tabIndex = -1;
						card.setAttribute("data-id", "");
					}
				});
			});
		}

		function filterCards(category) {
			const searchTerm = document.getElementById("searchBar").value.toLowerCase();
			const cards = document.querySelectorAll(".card-item");
			const buttons = document.querySelectorAll(".btn-group .btn");
			const activeButton = document.querySelector(`.btn-group .btn.btn-primary[data-category="${category}"]`);
			activeFilter = category;
			if (activeButton) {
				// If the clicked button is already active, remove the filter
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					card.style.display = title.includes(searchTerm) ? "block" : "none";
				});

				// Reset all buttons to their original background color
				buttons.forEach((button) => {
					button.classList.add(button.dataset.originalBg);
					button.classList.remove("btn-primary");
				});
				activeFilter = null;
			} else {
				// Apply the filter
				cards.forEach((card) => {
					const title = card.dataset.title.toLowerCase();
					const matchesSearch = title.includes(searchTerm);
					const matchesCategory = card.getAttribute("data-category") === category;

					card.style.display = matchesSearch && matchesCategory ? "block" : "none";
				});

				// Update button styles
				buttons.forEach((button) => {
					if (button.getAttribute("data-category") === category) {
						button.classList.add(button.dataset.originalBg);
						button.classList.add("btn-primary");
					} else {
						button.classList.remove(button.dataset.originalBg);
					}
				});
			}
			let i = 0;
			cards.forEach((card) => {
				if (card.style.display === "block") {
					card.querySelector("img").tabIndex = 0;
					card.setAttribute("data-id", i);
					i += 1;
				} else {
					card.querySelector("img").tabIndex = -1;
					card.setAttribute("data-id", "");
				}
			});
		}

		function setupSkipButton() {
			const skipButton = document.getElementById("skipToCards");
			["click", "keydown"].forEach(function (e) {
				skipButton.addEventListener(e, () => {
					if (e === "keydown" && event.key !== "Enter") {
						return;
					}
					const firstVisibleCard = Array.from(document.querySelectorAll('.card-item')).find(card =>
						window.getComputedStyle(card).display !== 'none')?.querySelector('img');
					console.log(firstVisibleCard);
					if (firstVisibleCard) {
						firstVisibleCard.focus();
						firstVisibleCard.scrollIntoView();
					}
					skipButton.blur();
				});
			});
		}
		function displayFamilyName(familyName) {
			isHovering = true;
			const nameDiv = document.querySelector('#nameOfFamily');
			const alertDiv = nameDiv.parentElement;

			nameDiv.textContent = familyName;
			alertDiv.classList.remove('d-none');

			// Set colors based on family name
			if (familyName.toLowerCase().includes('journée')) {
				alertDiv.style.backgroundColor = '#207cc4';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('accessibilité')) {
				alertDiv.style.backgroundColor = '#c0245c';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('matériel')) {
				alertDiv.style.backgroundColor = '#f09424';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('numérique')) {
				alertDiv.style.backgroundColor = '#78c444';
				nameDiv.style.color = 'white';
			} else if (familyName.toLowerCase().includes('événements')) {
				alertDiv.style.backgroundColor = '#68449c';
				nameDiv.style.color = 'white';
			}
		}

		function updateDisplayedText() {
			const activeFamilyName = getActiveFamilyName();
			if (activeFamilyName) {
				displayFamilyName(activeFamilyName);
			} else {
				hideFamilyName();
			}
		}

		function getActiveFamilyName() {
			if (activeFilter) {
				console.log(activeFilter);
				const button = document.querySelector(`.filter-button[data-category="${activeFilter}"]`);
				return button ? button.getAttribute("familyName") : null;
			}
			return null;
		}

		let hideTimeout;

		function hideFamilyName() {
			isHovering = false;
			clearTimeout(hideTimeout);
			hideTimeout = setTimeout(() => {
				if (!activeFilter && !isHovering) {
					const nameDiv = document.querySelector('#nameOfFamily');
					nameDiv.parentElement.classList.add('d-none');
				}
			}, 1000);
		}

		function handleButtonHover() {
			isHovering = true;
			clearTimeout(hideTimeout);
		}

		function fetchAndDisplayCards() {
			fetch("../data/cartes.json")
				.then((response) => response.json())
				.then((data) => {
					const buttonGroup = document.querySelector(".btn-group");

					// Create a button for each famille using famille.titre
					data.familles.forEach((famille) => {
						const button = document.createElement("button");
						button.className = "btn btn-secondary me-1 rounded-pill filter-button"; // Add 'me-2' to add margin to the end of each button
						button.setAttribute("data-category", famille.id);
						button.addEventListener("click", () => filterCards(famille.id));
						buttonGroup.appendChild(button);
						button.classList.add("filter-button");
						button.setAttribute("familyName", famille.titre);
						button.setAttribute("title", `Filtrer par ${famille.titre}`);
						if (famille.id == "organisation-de-la-journee") {
							button.classList.add("bluebg");
							button.dataset.originalBg = "bluebg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Bleu";
							}
						}
						if (famille.id == "accessibilite-des-lieux") {
							button.classList.add("redbg");
							button.dataset.originalBg = "redbg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Rouge";
							}
						}
						if (famille.id == "materiel") {
							button.classList.add("orangebg");
							button.dataset.originalBg = "orangebg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Orange";
							}
						}
						if (famille.id == "numerique") {
							button.classList.add("greenbg");
							button.dataset.originalBg = "greenbg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Vert";
							}
						}
						if (famille.id == "evenements-sociaux-professionnels") {
							button.classList.add("purplebg");
							button.dataset.originalBg = "purplebg";
							if (window.innerWidth >= 1000) {
								button.textContent = "Violet";
							}
						}
						button.addEventListener("mouseover", () => displayFamilyName(famille.titre));
						button.addEventListener("mouseout", updateDisplayedText);
					});

					const cardGrid = document.getElementById("cardGrid");
					cardGrid.innerHTML = "";
					let i = 0;
					let previousfamily = "";
					let idNum = 0;
					data.familles.forEach((famille) => {
						famille.cartes.forEach((carte) => {
							if (previousfamily != famille.id) {
								idNum = 0;
							}
							idNum += 1;
							let addon = "";
							console.log(famille.id);
							if (famille.id == "organisation-de-la-journee") {
								addon = "BL";
							}
							if (famille.id == "accessibilite-des-lieux") {
								addon = "RO";
							}
							if (famille.id == "materiel") {
								addon = "OR";
							}
							if (famille.id == "numerique") {
								addon = "VE";
							}
							if (famille.id == "evenements-sociaux-professionnels") {
								addon = "VI";
							}
							const card = document.createElement("div");
							card.className = "col card-item";
							card.setAttribute("data-category", famille.id);
							card.setAttribute("data-title", carte.titre);
							card.setAttribute("data-subtitle", carte.sousTitre);
							card.setAttribute("data-description", carte.description);
							card.setAttribute("data-image", `${carte.id}-${addon}0${idNum}.png`);
							card.setAttribute("data-id", i);

							card.style.display = "block";
							i += 1;
							previousfamily = famille.id;

							// Afficher uniquement l'image dans la carte
							card.innerHTML = `
						<div class="card h-100" role="listitem" aria-labelledby="card-title-${carte.id}" aria-describedby="card-description-${carte.id}">
							<img src="../img/cartes_new/${carte.id}-${addon}0${idNum}.png" class="card-img-top h-100" alt="${carte.titre}" tabindex="0" aria-labelledby="card-title-${carte.id}" />

						</div>
					`;

							cardGrid.appendChild(card);
						});
					});

					// Ajouter des écouteurs d'événements aux images après l'ajout de toutes les cartes
					document.querySelectorAll(".card-item img").forEach((img) => {
						["click", "keydown"].forEach(function (e) {
							img.addEventListener(e, () => {
								if (e === "keydown" && event.key !== "Enter") {
									return;
								}
								const card = img.closest(".card-item");
								const title = card.dataset.title;
								const subTitle = card.dataset.subtitle;
								const description = card.dataset.description;
								const id = card.dataset.id;

								// Création du modal avec uniquement l'image et le contenu de la carte
								const modal = document.createElement("div");
								modal.className = "modal fade";
								modal.tabIndex = -1;
								modal.innerHTML = `
												<div class="modal-dialog modal-dialog-centered modal-xl" role="dialog" aria-labelledby="modalTitle" aria-describedby="modalDescription">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="modal-title" id="modalTitle">${title}</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body d-flex text-center" id="modalDescription">
															<div class="d-flex justify-content-between align-items-center w-100">
																<button type="button" class="btn btn-secondary me-2" id="prevCard" data-id="${id}" aria-label="Previous card">&#11164;</button>
																<div class="w-75 me-5">
																	<img src="../img/cartes_new/${card.dataset.image}" class="img-fluid" alt="${title}" />
																</div>
																<div class="w-50 ms-2">
																	<h6 class="subTitle">"${subTitle}"</h6>
																	<p class="description">${description}</p>
																</div>
																<button type="button" class="btn btn-secondary ms-2" id="nextCard" data-id="${id}" aria-label="Next card">&#11166;</button>
															</div>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fermer</button>
															<button type="button" class="btn btn-info">Ecouter la carte</button>
														</div>
													</div>
												</div>
											`;

								document.body.appendChild(modal);
								const bootstrapModal = new bootstrap.Modal(modal);
								bootstrapModal.show();

								// Lecture de la carte
								modal.querySelector(".btn-info").addEventListener("click", () => {
									const utterance = new SpeechSynthesisUtterance(`${title}. ${subTitle}. ${description}`);
									utterance.lang = "fr-FR";
									synth.speak(utterance);
								});
								modal.querySelectorAll("button").forEach((button) => {
									addEventToCursorCircle(button);
								});
								modal.querySelectorAll("#nextCard, #prevCard").forEach((button) => {
									button.addEventListener("click", () => {
										handleCardNavigation(button.id === "nextCard" ? "next" : "prev", parseInt(button.dataset.id));
									});
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "Escape") {
										bootstrapModal.hide();
									}
								});
								document.addEventListener("keydown", (event) => {
									if (event.key === "p") {
										synth.cancel();
									}
								});

								// Suppression du modal après sa fermeture
								modal.addEventListener("hidden.bs.modal", () => {
									modal.remove();
								});
							});
						});
					});

					document.querySelectorAll("a, button, input, img, .btn-group .btn, .btn-info").forEach((element) => {
						addEventToCursorCircle(element);
					});
				})
				.catch((error) => console.error("Error fetching data:", error));
		}

		function handleCardNavigation(direction, id) {
			const allcards = document.querySelectorAll(".card-item");
			const cards = Array.from(allcards).filter((card) => card.style.display === "block");
			const modal = document.querySelector(".modal");
			const nextCard = direction === "next" ? id + 1 : id - 1;
			const card = cards[nextCard];
			if (card) {
				const title = card.dataset.title;
				const subTitle = card.dataset.subtitle;
				const description = card.dataset.description;
				const image = card.dataset.image;
				const id = card.dataset.id;

				modal.querySelector(".modal-title").textContent = title;
				modal.querySelector("img").src = `../img/cartes_new/${image}`;
				modal.querySelector("img").alt = title;
				modal.querySelector("h6").textContent = subTitle;
				modal.querySelector("p").textContent = description;
				modal.querySelector("#nextCard").dataset.id = id;
				modal.querySelector("#prevCard").dataset.id = id;
			} else {
				if (direction === "next") {
					const title = cards[0].dataset.title;
					const subTitle = cards[0].dataset.subtitle;
					const description = cards[0].dataset.description;
					const image = cards[0].dataset.image;
					const id = cards[0].dataset.id;

					modal.querySelector(".modal-title").textContent = title;
					modal.querySelector("img").src = `../img/cartes_new/${image}`;
					modal.querySelector("img").alt = title;
					modal.querySelector("h6").textContent = subTitle;
					modal.querySelector("p").textContent = description;
					modal.querySelector("#nextCard").dataset.id = id;
					modal.querySelector("#prevCard").dataset.id = id;
				} else {
					const title = cards[cards.length - 1].dataset.title;
					const subTitle = cards[cards.length - 1].dataset.subtitle;
					const description = cards[cards.length - 1].dataset.description;
					const image = cards[cards.length - 1].dataset.image;
					const id = cards[cards.length - 1].dataset.id;

					modal.querySelector(".modal-title").textContent = title;
					modal.querySelector("img").src = `../img/cartes_new/${image}`;
					modal.querySelector("img").alt = title;
					modal.querySelector("h6").textContent = subTitle;
					modal.querySelector("p").textContent = description;
					modal.querySelector("#nextCard").dataset.id = id;
					modal.querySelector("#prevCard").dataset.id = id;
				}
			}
		}

		function addEventToCursorCircle(element) {
			element.addEventListener("mouseover", () => {
				element.style.cursor = "pointer";
				cursorCircle.style.transform = "scale(2)";
				cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
			});
			element.addEventListener("mouseleave", () => {
				cursorCircle.style.transform = "scale(1)";
				cursorCircle.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
			});
		}

		function setupCursorCircle() {
			cursorCircle.style.cssText = `
						z-index: 9999;
						position: fixed;
						width: 30px;
						height: 30px;
						border-radius: 50%;
						background-color: rgba(0, 0, 0, 0.5);
						pointer-events: none;
						transition: transform 0.2s ease;
					`;
			document.body.appendChild(cursorCircle);

			function handleMouseMove(event) {
				const xoffset = 15;
				const yoffset = 15;
				const y = event.pageY;
				const x = event.pageX;
				const ref = cursorCircle;
				const scrollLeft = window.scrollX !== undefined ? window.scrollX : (document.documentElement || document.body.parentNode || document.body).scrollLeft;
				const scrollTop = window.scrollY !== undefined ? window.scrollY : (document.documentElement || document.body.parentNode || document.body).scrollTop;
				ref.style.left = x - scrollLeft - xoffset + "px";
				ref.style.top = y - scrollTop - yoffset + "px";
			}

			document.addEventListener("mousemove", handleMouseMove, false);
			document.addEventListener("mouseleave", () => {
				cursorCircle.style.display = "none";
			});
			document.addEventListener("mouseenter", () => {
				cursorCircle.style.display = "block";
			});
		}

		function handleKeyEvents() {
			document.addEventListener("keydown", (event) => {
				const modal = document.querySelector(".modal");
				if (modal) {
					if (event.key === "ArrowLeft") {
						const id = parseInt(modal.querySelector("#prevCard").dataset.id);
						handleCardNavigation("prev", id);
					}
					if (event.key === "ArrowRight") {
						const id = parseInt(modal.querySelector("#nextCard").dataset.id);
						handleCardNavigation("next", id);
					}
				}
			});
		}

		// Initialize functions on DOMContentLoaded
		document.addEventListener("DOMContentLoaded", () => {
			initalizeScrollUpButton();
			setupCursorCircle();
			initializeSearchBar();
			setupSkipButton();
			fetchAndDisplayCards();
			handleKeyEvents();
		});
	</script>

</body>

</html>